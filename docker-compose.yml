version: '3.4'

services:
  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    environment:
      GF_SECURITY_ADMIN_PASSWORD: notsecret
      GF_AUTH_PROXY_ENABLED: "true"
      GF_AUTH_PROXY_HEADER_NAME: X-WEBAUTH-EMAIL
      GF_AUTH_PROXY_AUTO_SIGN_UP: "false"
    volumes:
      - ./grafana_lib_data:/var/lib/grafana
      - ./grafana_data:/etc/grafana/data
  web-debug-server:
    image: itzg/web-debug-server:1.2.3
    ports:
      - "8081:8080"
  saml-auth-proxy:
    # image: itzg/saml-auth-proxy
    build: .
    environment:
      SAML_PROXY_BASE_URL: http://localhost:8080
      SAML_PROXY_BACKEND_URL: http://grafana:3000
      SAML_PROXY_IDP_METADATA_URL: https://samltest.id/saml/idp
      SAML_PROXY_ATTRIBUTE_HEADER_MAPPINGS: mail=x-webauth-email
      SAML_PROXY_AUTHORIZE_ATTRIBUTE: mail
      SAML_PROXY_AUTHORIZE_VALUES: rsanchez@samltest.id,msmith@samltest.id
      SAML_PROXY_SP_CERT_PATH: /app/certs/saml-auth-proxy.cert
      SAML_PROXY_SP_KEY_PATH: /app/certs/saml-auth-proxy.key
      GRAFANA_SAML_CONFIG_LOCATION: /app/data/grafana-saml-config.json
      GRAFANA_URL: http://grafana:3000
      GRAFANA_ADMIN_USER: admin
      GRAFANA_ADMIN_PASSWORD: notsecret
    ports:
      - "8080:8080"
    volumes:
      - ./certs:/app/certs
      - ./data:/app/data
    